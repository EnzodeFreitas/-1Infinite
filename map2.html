<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mapa Leaflet</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />
<style>
  #map { height: 90vh; width: 100%; }
</style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
// Mapa básico
var map = L.map('map').setView([0, 0], 2);

L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {}).addTo(map);

var drawnItems = new L.FeatureGroup();
map.addLayer(drawnItems);

var drawControl = new L.Control.Draw({
  edit: { featureGroup: drawnItems },
  draw: {
    polygon: true,
    circle: true,
    rectangle: true,
    marker: true,
    polyline: true
  }
});
map.addControl(drawControl);

const formatDate = d3.timeFormat("%Y-%m-%d");

map.on('draw:created', function (event) {
  const layer = event.layer;
  drawnItems.addLayer(layer);

  const today = formatDate(new Date());

  // Pega dados do localStorage ou inicializa
  let userActivityByDate = JSON.parse(localStorage.getItem('userActivityByDate')) || {};

  userActivityByDate[today] = (userActivityByDate[today] || 0) + 1;

  localStorage.setItem('userActivityByDate', JSON.stringify(userActivityByDate));

  alert("Atividade adicionada para " + today + "!\n\nAtualize a página do Heatmap para ver as mudanças.");
});

</script>

</body>
</html>
